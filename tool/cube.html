<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		  content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>魔方</title>
	<link rel="stylesheet" href="../static/css/base.css"/>
	<style>
		#cube {width: 500px; height: 500px;}
		#control td {border: 1px solid;}
		#control td button {font-family: monospace;}
		#middle {display: flex; flex-direction: row;}
		button {padding: 0.3em 1em; min-width: 4em;}
		.texture {width: 333px; height: 333px; flex-shrink: 0; border: 1px solid;}
	</style>
	<link rel="stylesheet" href="../static/drawingboard/drawingboard.css">
</head>
<body>
	<!-- 本人不太会js，以下代码都是现学的，所以不一定能写得很好看（ -->
	<div id="cube"></div>
	<div id="control">
		<div>
			<button onclick="createMirror()" title="略吃性能, 现在已经降低帧率所以还好">添加镜子</button>
			<button onclick="removeMirror()">移除镜子</button>
		</div>
		<table>
			<tr>
				<td>
					<button onclick="execute('U')">U</button>
					<button onclick="execute('U\'')">U'</button>
					<button onclick="execute('U U')">U2</button>
				</td>
				<td>
					<button onclick="execute('R')">R</button>
					<button onclick="execute('R\'')">R'</button>
					<button onclick="execute('R R')">R2</button>
				</td>
				<td>
					<button onclick="execute('F')">F</button>
					<button onclick="execute('F\'')">F'</button>
					<button onclick="execute('F F')">F2</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="execute('D')">D</button>
					<button onclick="execute('D\'')">D'</button>
					<button onclick="execute('D D')">D2</button>
				</td>
				<td>
					<button onclick="execute('L')">L</button>
					<button onclick="execute('L\'')">L'</button>
					<button onclick="execute('L L')">L2</button>
				</td>
				<td>
					<button onclick="execute('B')">B</button>
					<button onclick="execute('B\'')">B'</button>
					<button onclick="execute('B B')">B2</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="execute('x')">x</button>
					<button onclick="execute('x\'')">x'</button>
					<button onclick="execute('x x')">x2</button>
				</td>
				<td>
					<button onclick="execute('y')">y</button>
					<button onclick="execute('y\'')">y'</button>
					<button onclick="execute('y y')">y2</button>
				</td>
				<td>
					<button onclick="execute('z')">z</button>
					<button onclick="execute('z\'')">z'</button>
					<button onclick="execute('z z')">z2</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="execute('u')">u</button>
					<button onclick="execute('u\'')">u'</button>
					<button onclick="execute('u u')">u2</button>
				</td>
				<td>
					<button onclick="execute('r')">r</button>
					<button onclick="execute('r\'')">r'</button>
					<button onclick="execute('r r')">r2</button>
				</td>
				<td>
					<button onclick="execute('f')">f</button>
					<button onclick="execute('f\'')">f'</button>
					<button onclick="execute('f f')">f2</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="execute('d')">d</button>
					<button onclick="execute('d\'')">d'</button>
					<button onclick="execute('d d')">d2</button>
				</td>
				<td>
					<button onclick="execute('l')">l</button>
					<button onclick="execute('l\'')">l'</button>
					<button onclick="execute('l l')">l2</button>
				</td>
				<td>
					<button onclick="execute('b')">b</button>
					<button onclick="execute('b\'')">b'</button>
					<button onclick="execute('b b')">b2</button>
				</td>
			</tr>
			<tr>
				<td>
					<button onclick="execute('E')">E</button>
					<button onclick="execute('E\'')">E'</button>
					<button onclick="execute('E E')">E2</button>
				</td>
				<td>
					<button onclick="execute('M')">M</button>
					<button onclick="execute('M\'')">M'</button>
					<button onclick="execute('M M')">M2</button>
				</td>
				<td>
					<button onclick="execute('S')">S</button>
					<button onclick="execute('S\'')">S'</button>
					<button onclick="execute('S S')">S2</button>
				</td>
			</tr>
		</table>
	</div>
	<div>以下功能，目前来看还不可用</div>
	<div id="texture-box">
		<div id="top" class="texture"></div>
		<div id="middle">
			<div id="left" class="texture"></div>
			<div id="front" class="texture"></div>
			<div id="right" class="texture"></div>
			<div id="back" class="texture"></div>
		</div>
		<div id="bottom" class="texture"></div>
		<button onclick="changeBackground()">提交</button>
	</div>
	<script src="/static/js/jquery-3.6.0.min.js"></script>
	<script src="/static/js/three/three.min.js"></script>
	<script src="/static/js/three/objects/Reflector.js"></script>
	<script src="/static/js/three/jq.cube.js"></script>
	<script src="/static/drawingboard/drawingboard.js"></script>
	<script>
		let cubeBox = $("#cube");
		let cube;
		let config = {
			camera: {
				x: 120,
				y: 120,
				z: 120,
			},
		};

		function start() {
			cube = cubeBox.html('').cube(config);
		}
		// 转动魔方
		function execute(moves) {
			cube.execute(moves);
		}
		// 添加镜子可以看到魔方背面
		function createMirror() {
			cube.createMirror();
		}
		// 移除镜子
		function removeMirror() {
			cube.removeMirror();
		}
		// 画背景
		var canvas = document.createElement('canvas');
		canvas.width = 333;
		canvas.height = 333;
		// canvas.style.display = 'none';
		var ctx = canvas.getContext("2d");
		ctx.fillStyle = "yellow";
		ctx.fillRect(0,0,333,333);
		ctx.beginPath();
		ctx.lineWidth = 2;
		ctx.strokeStyle = "black";
		ctx.moveTo(0, 0);
		ctx.lineTo(0, 333);
		ctx.lineTo(333, 333);
		ctx.lineTo(333, 0);
		ctx.lineTo(0, 0);
		ctx.moveTo(111, 0);
		ctx.lineTo(111, 333);
		ctx.moveTo(222, 0);
		ctx.lineTo(222, 333);
		ctx.moveTo(0, 111);
		ctx.lineTo(333, 111);
		ctx.moveTo(0, 222);
		ctx.lineTo(333, 222);
		ctx.closePath();
		ctx.stroke();

		var baseStrTop = canvas.toDataURL("image/png");

		start();
		let myBoardTop = new DrawingBoard.Board('top', {enlargeYourContainer:true, background: baseStrTop});
		let myBoardLeft = new DrawingBoard.Board('left', {enlargeYourContainer:true});
		let myBoardFront = new DrawingBoard.Board('front', {enlargeYourContainer:true});
		let myBoardRight = new DrawingBoard.Board('right', {enlargeYourContainer:true});
		let myBoardBack = new DrawingBoard.Board('back', {enlargeYourContainer:true});
		let myBoardBottom = new DrawingBoard.Board('bottom', {enlargeYourContainer:true});
		let ml = $('#left').width();
		$('#top,#bottom').css('margin-left', ml);

		function changeBackground() {
			config.color = [
				0xff0000, //right
				0xffa500, //left
				myBoardTop.getImg(), //top
				0xffffff, //bottom
				0x0000ff, //front
				0x00ff00, //back
				0x000000 //cube color
			];
			cubeBox.reset();
			cube = cubeBox.html('').cube(config);
		}
	</script>
</body>
</html>